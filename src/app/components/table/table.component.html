<div class="table-wrapper">

   <div class="table-controls">

      <div class="search-box">
         <i-tabler name="search" class="search-icon"></i-tabler>
         <input type="text" placeholder="Buscar registros..." (keyup)="filter(input.value)" #input class="clean-input">
      </div>

      @if(filters.length) {
      <button (click)="open_filters()" class="filter-btn" mat-ripple>
         <i-tabler name="adjustments-horizontal" class="icon-20"></i-tabler>
         <span class="hidden sm:inline">Filtros</span>
      </button>
      }
   </div>

   @if(applied_filters) {
   <div class="chips-container">
      @for(filter of applied_filters | keyvalue; track $index) {
      @if(filter.value){
      <div class="filter-chip">
         <span class="font-medium">{{filter.key.slice(3)}}:</span>
         <span class="ml-1">{{filter.value}}</span>
         <button (click)="delete_filter(filter.key)" class="close-chip">
            <i-tabler name="x" class="icon-14"></i-tabler>
         </button>
      </div>
      }
      }
   </div>
   }

   <div class="table-container shadow-sm">
      <table mat-table [dataSource]="ui_data" matSort class="w-full">

         @for (column of columns; track $index) {
         @if (column != 'Acciones') {
         <ng-container [matColumnDef]="column">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="custom-header"
               [ngClass]="_layout.hide_id(column)">
               {{ column.slice(3) }}
            </th>

            <td mat-cell *matCellDef="let row" class="custom-cell" [ngClass]="_layout.hide_id(column)">

               @switch (column) {
               @case('00_IMG') {
               <div class="img-wrapper">
                  @if(!row[column]) {
                  <div class="img-placeholder">
                     <i-tabler name="photo" class="text-gray-400"></i-tabler>
                  </div>
                  } @else {
                  <img [src]="row[column]" (error)="row[column] = null" class="row-img" />
                  }
               </div>
               }
               @default {
               <span class="text-gray-700">
                  @if (column.includes('fecha')) {
                  {{ row[column] | date: 'dd MMM yyyy' }}
                  } @else {
                  {{ row[column] }}
                  }
               </span>
               }
               }
            </td>
         </ng-container>
         }
         }

         <ng-container matColumnDef="Acciones" stickyEnd>
            <th mat-header-cell *matHeaderCellDef class="custom-header w-[100px] text-right"></th>
            <td mat-cell *matCellDef="let row" class="custom-cell text-right">
               <div class="flex justify-end gap-1">
                  @if (!_router.url.includes("dashboard")) {
                  <button mat-icon-button class="action-btn edit" (click)="clickElemento(row)" matTooltip="Editar">
                     <i-tabler name="pencil" class="icon-18"></i-tabler>
                  </button>
                  <button mat-icon-button class="action-btn delete" (click)="eliminarElemento(row)"
                     matTooltip="Eliminar">
                     <i-tabler name="trash" class="icon-18"></i-tabler>
                  </button>
                  } @else {
                  <button mat-icon-button class="action-btn view" (click)="verElemento(row)" matTooltip="Ver detalle">
                     <i-tabler name="eye" class="icon-18"></i-tabler>
                  </button>
                  }
               </div>
            </td>
         </ng-container>

         <tr mat-header-row *matHeaderRowDef="columns; sticky: true"></tr>
         <tr mat-row *matRowDef="let row; columns: columns" class="hover-row"></tr>

         <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="100%">
               <div class="empty-state">
                  <div class="empty-img-bg">
                     <img src="assets/egreso.svg" alt="No data" class="w-32 opacity-80">
                  </div>
                  <h3 class="text-lg font-bold text-gray-700 mt-4">Sin resultados</h3>
                  <p class="text-gray-500 mb-4">No encontramos registros para tu b√∫squeda.</p>
                  <button class="primary-btn" (click)="clickElemento(null)">
                     <i-tabler name="plus" class="icon-18 mr-2"></i-tabler>
                     Agregar Nuevo
                  </button>
               </div>
            </td>
         </tr>

      </table>
   </div>

   <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" showFirstLastButtons class="custom-paginator"></mat-paginator>

</div>